@page "/add_category"
@layout MainLayout
@using System.Text
@inject NavigationManager navigation;
@inject IJSRuntime JsRuntime

<div class="card">
    <div class="card-header">
        <h3>ADD CATEGORY</h3>
    </div>
    <div class="card-body">
        <EditForm OnInvalidSubmit="@Submit" Model="@category">
            <DataAnnotationsValidator />
            <ValidationSummary />
            <div class="form-group">
                <label for="Name" >CATEGORY NAME</label>
                <InputText id="Name" class="form-control" @bind-Value="category.Name"/>
            </div>
            <div class="form-group mt-2">
                <input class="btn-sm btn-primary" type="submit" @onclick="@Submit"/>
            </div>
        </EditForm>
    </div>
</div>



@code {
    private Category category = new ();
    private async void Submit()
    {
        var json = Newtonsoft.Json.JsonConvert.SerializeObject(category);
        HttpContent data = new StringContent(json, Encoding.UTF8, "application/json");
        HttpClient httpClient = new HttpClient();
        
        try
        {
            var response = await httpClient.PostAsync("https://farm-web-api.herokuapp.com/api/Categories", data);
        if (response.IsSuccessStatusCode)
        {
            var message = await response.Content.ReadAsStringAsync();
            navigation.NavigateTo("categories_page");
        }
        else
        {
            await JsRuntime.InvokeVoidAsync("Error", "Something went wrong!");
        }
        }
        catch (Exception ex)
        {
            await JsRuntime.InvokeVoidAsync("Error", $"Something went wrong! \n{ex.Message}");
        }
    }
}
